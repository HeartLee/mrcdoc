# 牧易API

### 1.coding上项目名: muyi-php，上面有两个分支

+ master分支是之前没有删减财务，关注列表，没有更改权限验证的代码

- muyi-new分支是删减了功能，改变登录方式之后的代码

### 2.代码使用php CI框架(CodeIgniter) + SQLSERVER编写

> 数据库配置

```angular2html
  $db['default'] = array(
  	'dsn'	=> '',
  	'hostname' => '114.112.100.156',
  	'username' => 'demo',
  	'password' => 'demo123',
  	'database' => 'appuser',
  	'dbdriver' => 'sqlsrv',
  	'dbprefix' => '',
  	'pconnect' => FALSE,
  	// 'db_debug' => (ENVIRONMENT !== 'production'),
  	'db_debug'=>TRUE,
  	'cache_on' => FALSE,
  	'cachedir' => '',
  	'char_set' => 'utf8',
  	// 'dbcollat' => 'utf8_general_ci',//只适用mysql mysqli数据库驱动
  	'swap_pre' => '',
  	'encrypt' => FALSE,
  	'compress' => FALSE,
  	'stricton' => FALSE,
  	'failover' => array(),
  	'save_queries' => TRUE
  );
```

### 3.代码结构
+ 控制器：Base,Site,Stock,User,Finance
* 模型：Sites,Stocks,tokens,Finances

+ 控制器
```angular2html
  + controllers 控制器
    - Base.php
    - Finance.php
    - Site.php
    - Stock.php
    - User.php
  + models 模型
    - Finances.php
    - Sites.php
    - Stocks.php
    - tokens.php
    - Users.php 
```

> 备注：Finance控制器，Finances模型在实际项目中已经不需要了，这块是财务方面的，如果以后还需要，可以在此基础上修改或扩展

### 4.libraries下的Util.php 用于APP中用户权限验证

```angular2html
    public static function authors($view,$userId){
            $rightsList =self::getUserRight($userId);
            return $view ?in_array($view,$rightsList) :false;
        }
        private static function getUserRight($userId){
            $where=['UserId'=>$userId,'查阅权限'=>'1'];
            $db =& get_instance();
            $rights=$db->db->select('项目 as viewName')->where($where)->from(self::author)->get()->result_array();
            $rights = array_column($rights, 'viewName');
            return array_unique($rights);
        }
```

### 5.牧易App开发群： 489208251



# 中国矿业联盟

### 1.coding上项目名: cumsi，上面有两个分支

+ master分支是只有前端静态页面
+ Ci分支是加上了后台管理，是这个整个网站（前端页面+后台）

### 2.代码使用php CI框架(CodeIgniter) + mysql 编写

> 数据库配置

```angular2html
  $db['default'] = array(
  	'dsn'	=> '',
  	'hostname' => 'wiki100.net:3306',//本地运行环境
  //	'hostname' => 'smcdb.c0to3pxvacb4.us-west-2.rds.amazonaws.com', //矿业联盟线上主机
  	'username' => 'root',
  //	'password' => 'smc201415', //矿业联盟线上密码
  	'password' => 'root',//本地密码
  	'database' => 'cumsi',
  	'dbdriver' => 'mysqli',
  	'dbprefix' => '',
  	'pconnect' => FALSE,
  	'db_debug' => (ENVIRONMENT !== 'production'),
  	'cache_on' => FALSE,
  	'cachedir' => '',
  	'char_set' => 'utf8',
  	'dbcollat' => 'utf8_general_ci',
  	'swap_pre' => '',
  	'encrypt' => FALSE,
  	'compress' => FALSE,
  	'stricton' => FALSE,
  	'failover' => array(),
  	'save_queries' => TRUE
  );
```
> 如果以后需要修改，运行在本地环境，请这样修改数据库配置文件

### 3.代码结构

+ 控制器
```angular2html
+controllers 控制器文件夹
  + console 后台控制器
    - Admin.php 
    - News.php
    - User.php
  + Home.php 前台控制器
```
+ 模型

```angular2html
  + models 模型文件夹
    - Cats.php
    - NewsModel.php
    - Users.php
```
+ 视图

```angular2html
  + views 视图文件夹
    + console 后台页面
      - add_banner.php
      - add_link.php
      - admin_modify.php
      - adminList.php
      - banner.php
      - banner-left.php
      - base_info.php
      - footer.php
      - header.php
      - index.php
      - inner-header.php
      - links.php
      - login.php
      - news.php
      - nwes_edit.php
      - sign-in.php
    + home 前台页面
      - about.php
      - driver.php
      - dynamic.php
      - footer.php
      - header.php
      - index.php
      - leftcon.php
      - manaUnit.php
      - new_detail.php
      - notice.php
      - organization.php
      - pagination.php
      - technology.php
      - unionFile.php
```
